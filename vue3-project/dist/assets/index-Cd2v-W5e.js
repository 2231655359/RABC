import{d as q,e as z,u as T,r as R,a as A,i as Y,j as G,f as n,o as i,c as v,g,b as t,w as s,h as $,t as B,k as b,l as J,m as K,n as Q,p as W,q as X,_ as U,F as I,s as ee,v as C,x as E,y as S,z as te}from"./index-DkugqgKa.js";import{f as se}from"./dateUtils-CvItVsSG.js";import{m as ne}from"./menuConfig-BcKxkvSg.js";const oe="data:image/svg+xml,%3csvg%20xmlns='http://www.w3.org/2000/svg'%20xmlns:xlink='http://www.w3.org/1999/xlink'%20aria-hidden='true'%20role='img'%20class='iconify%20iconify--logos'%20width='37.07'%20height='36'%20preserveAspectRatio='xMidYMid%20meet'%20viewBox='0%200%20256%20198'%3e%3cpath%20fill='%2341B883'%20d='M204.8%200H256L128%20220.8L0%200h97.92L128%2051.2L157.44%200h47.36Z'%3e%3c/path%3e%3cpath%20fill='%2341B883'%20d='m0%200l128%20220.8L256%200h-51.2L128%20132.48L50.56%200H0Z'%3e%3c/path%3e%3cpath%20fill='%2335495E'%20d='M50.56%200L128%20133.12L204.8%200h-47.36L128%2051.2L97.92%200H50.56Z'%3e%3c/path%3e%3c/svg%3e",le={class:"header"},ae={class:"el-dropdown-link"},re={class:"date"},de={class:"dialog-footer"},ue=q({__name:"index",setup(V){let w=z(),a=T(),c=R(!1);const o=A({oldPass:"",pass:"",checkPass:""}),k=R(),p=A({oldPass:[{required:!0,validator:(_,e,f)=>{var h;Q({userId:(h=a.user)==null?void 0:h._id,password:e}).then(x=>{x.status==0?f():f(new Error(x.msg))})},trigger:"blur"}],pass:[{required:!0,message:"请输入新密码",trigger:"blur"},{min:4,message:"请输入4位以上长度的密码",trigger:["blur","change"]}],checkPass:[{required:!0,validator:(_,e,f)=>{e!=o.pass?f(new Error("两次输入密码不一致")):f()},trigger:"blur"}]}),u=()=>{c.value=!0,X(()=>{var _;(_=k.value)==null||_.resetFields()})},r=async _=>{_&&await _.validate(async(e,f)=>{var h;e&&W({userId:(h=a.user)==null?void 0:h._id,password:o.pass}).then(x=>{x.status==0&&(L(),c.value=!1)})})},M=_=>{switch(_){case"a":u();break;case"b":L();break}},L=()=>{a.removeUser(),a.user||w.replace("/login")};let y=R(""),P=null,D=()=>{P=setInterval(()=>{y.value=se(Date.now())},1e3)};return Y(()=>{D()}),G(()=>{clearInterval(P),P=null}),(_,e)=>{const f=n("el-icon"),h=n("el-dropdown-item"),x=n("el-dropdown-menu"),H=n("el-dropdown"),F=n("el-input"),N=n("el-form-item"),O=n("el-form"),Z=n("el-button"),j=n("el-dialog");return i(),v("div",le,[e[8]||(e[8]=g("a",{href:"#"},[g("img",{src:oe,class:"logo",width:"25px"}),g("span",{class:"title"},"RBAC学员管理系统")],-1)),t(H,{onCommand:M,trigger:"click"},{dropdown:s(()=>[t(x,null,{default:s(()=>[t(h,{command:"a"},{default:s(()=>e[5]||(e[5]=[$("修改密码")])),_:1}),t(h,{command:"b"},{default:s(()=>e[6]||(e[6]=[$("退出登录")])),_:1})]),_:1})]),default:s(()=>{var d;return[g("span",ae,[$(B((d=b(a).user)==null?void 0:d.username),1),t(f,{class:"el-icon--right"},{default:s(()=>[t(b(J))]),_:1})])]}),_:1}),g("span",re,B(b(y)),1),t(j,{modelValue:b(c),"onUpdate:modelValue":e[4]||(e[4]=d=>K(c)?c.value=d:c=d),title:"修改密码",width:"500"},{footer:s(()=>[g("div",de,[t(Z,{type:"primary",onClick:e[3]||(e[3]=d=>r(k.value))},{default:s(()=>e[7]||(e[7]=[$(" 提交 ")])),_:1})])]),default:s(()=>[t(O,{model:o,rules:p,ref_key:"userFormRef",ref:k,"label-width":"100px","label-position":"right",style:{width:"400px"}},{default:s(()=>[t(N,{label:"原始密码",prop:"oldPass"},{default:s(()=>[t(F,{modelValue:o.oldPass,"onUpdate:modelValue":e[0]||(e[0]=d=>o.oldPass=d),type:"password"},null,8,["modelValue"])]),_:1}),t(N,{label:"新密码",prop:"pass"},{default:s(()=>[t(F,{modelValue:o.pass,"onUpdate:modelValue":e[1]||(e[1]=d=>o.pass=d),type:"password"},null,8,["modelValue"])]),_:1}),t(N,{label:"确认密码",prop:"checkPass"},{default:s(()=>[t(F,{modelValue:o.checkPass,"onUpdate:modelValue":e[2]||(e[2]=d=>o.checkPass=d),type:"password"},null,8,["modelValue"])]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["modelValue"])])}}}),ie=U(ue,[["__scopeId","data-v-359471a8"]]),ce={name:"Menu",props:["menuList"]};function _e(V,w,a,c,o,k){const l=n("el-icon"),m=n("el-menu-item"),p=n("Menu"),u=n("el-sub-menu");return i(),v("div",null,[(i(!0),v(I,null,ee(a.menuList,r=>(i(),v(I,{key:r.index},[r.children?S("",!0):(i(),C(m,{key:0,index:r.index},{title:s(()=>[t(l,null,{default:s(()=>[(i(),C(E(r.icon)))]),_:2},1024),g("span",null,B(r.title),1)]),_:2},1032,["index"])),r.children?(i(),C(u,{key:1,index:r.index},{title:s(()=>[t(l,null,{default:s(()=>[(i(),C(E(r.icon)))]),_:2},1024),g("span",null,B(r.title),1)]),default:s(()=>[t(p,{menuList:r.children},null,8,["menuList"])]),_:2},1032,["index"])):S("",!0)],64))),128))])}const pe=U(ce,[["render",_e]]),me={class:"navbar"},fe=q({__name:"index",setup(V){let w=te(),a=T();const c=l=>{var M,L,y;const{index:m,isPublic:p}=l,u=(L=(M=a.user)==null?void 0:M.role)==null?void 0:L.menus;return((y=a.user)==null?void 0:y.username)=="admin"||p||(u==null?void 0:u.indexOf(m))!=-1?!0:l.children?!!l.children.find(P=>u.indexOf(P.index)!=-1):!1};let o=[];return(()=>{ne.forEach(l=>{if(!l.children)c(l)&&o.push(l);else{let m=[];l.children.forEach(u=>{c(u)&&m.push(u)});let p={...l,children:m};o.push(p)}})})(),(l,m)=>{const p=n("el-menu");return i(),v("div",me,[t(p,{"active-text-color":"#ffd04b","background-color":"#545c64",class:"el-menu-vertical-demo","default-active":b(w).path,"text-color":"#fff",router:!0,"default-openeds":["/students"]},{default:s(()=>[t(pe,{menuList:b(o)},null,8,["menuList"])]),_:1},8,["default-active"])])}}}),he={},ge={class:"main"};function ve(V,w){const a=n("router-view");return i(),v("div",ge,[t(a)])}const we=U(he,[["render",ve]]),xe=q({__name:"index",setup(V){return(w,a)=>(i(),v("div",null,[t(ie),t(fe),t(we)]))}}),ye=U(xe,[["__scopeId","data-v-972b3d76"]]);export{ye as default};
