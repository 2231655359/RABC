import{a as Z}from"./dateUtils-CvItVsSG.js";import{u as G}from"./role-7JurnY40.js";import{d as H,r as i,u as J,a as K,i as Q,o as y,c as B,g as E,b as t,w as n,q as X,f as d,h as b,k as u,F as Y,s as O,B as ee,E as le,v as te}from"./index-DkugqgKa.js";const oe={style:{margin:"20px 0"}},re={class:"dialog-footer"},me=H({__name:"User",setup(ae){let c=G(),m=i([]),p=J();const S=l=>{k(),p.getUserById(l).then(e=>{a.value=e})},q=l=>{l&&l.validate(e=>{e?p.updateUser(a.value).then(()=>{_.value=!1,g()}):console.log("error submit!")})},F=l=>{ee.confirm("确定要删除此条数据码?","Warning",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(()=>{p.deleteUser(l).then(()=>{le({type:"success",message:"删除成功！"}),g()})}).catch(()=>{})},C=i([]),$=(l,e,r,s)=>Z(r),D=(l,e,r,s)=>{var x;return(((x=m==null?void 0:m.value)==null?void 0:x.find(f=>f._id==r))||{}).name},L=()=>{var l;(l=c.roles)!=null&&l.length?m.value=c.roles:c.roleList().then(()=>{m.value=c.roles})},w=i(1),V=i(5),z=i(0),R=l=>{V.value=l,g()},P=l=>{w.value=l,g()},g=()=>{p.getUserList({page:w.value,size:V.value}).then(l=>{C.value=p.users,z.value=l==null?void 0:l.total})},k=()=>{_.value=!0,a.value={_id:null,username:"",name:"",password:"",role_id:"",phone:""},X(()=>{var l;(l=h.value)==null||l.resetFields()})};let a=i({_id:null,username:"",name:"",password:"",role_id:"",phone:""});const _=i(!1),h=i(),T=K({username:[{required:!0,validator:(l,e,r)=>{e=e.trim();const s=e&&e.length,U=/^[a-zA-Z0-9_]+$/;e==""?r(new Error("请输入账号")):s<4||s>12?r(new Error("请输入4到12位直接的账号")):U.test(e)?r():r(new Error("账号只能包含英文字母数字和下划线"))},trigger:["blur","change"]}],password:[{required:!0,message:"请输入密码",trigger:"blur"},{min:4,message:"请输入4位以上长度的密码",trigger:["blur","change"]}],name:[{required:!0,message:"请输入姓名",trigger:"blur"}],role_id:[{required:!0,message:"请选择所属角色",trigger:"change"}],phone:[{required:!0,validator:(l,e,r)=>{e=e.trim();const s=/^(13[0-9]|14[01456879]|15[0-35-9]|16[2567]|17[0-8]|18[0-9]|19[0-35-9])\d{8}$/;e==""?r(new Error("请输入手机号码")):s.test(e)?r():r(new Error("请输入正确的手机号码"))},trigger:["blur","change"]}]}),M=l=>{l&&l.validate(e=>{e?p.addUser(a.value).then(()=>{_.value=!1,g()}):console.log("error submit!")})};return Q(()=>{L(),g()}),(l,e)=>{const r=d("el-button"),s=d("el-table-column"),U=d("el-table"),x=d("el-pagination"),f=d("el-input"),v=d("el-form-item"),N=d("el-option"),A=d("el-select"),j=d("el-form"),I=d("el-dialog");return y(),B("div",null,[E("div",oe,[t(r,{type:"primary",onClick:k},{default:n(()=>e[10]||(e[10]=[b("添加用户")])),_:1})]),t(U,{data:C.value,style:{width:"100%",height:"380px"}},{default:n(()=>[t(s,{label:"序号",type:"index",width:"60"}),t(s,{label:"用户名",prop:"username"}),t(s,{label:"姓名",prop:"name"}),t(s,{label:"电话号码",prop:"phone"}),t(s,{label:"创建时间",prop:"create_time",formatter:$}),t(s,{label:"所属角色",prop:"role_id",formatter:D}),t(s,{label:"操作"},{default:n(o=>[t(r,{size:"small",onClick:W=>S(o.row._id)},{default:n(()=>e[11]||(e[11]=[b(" 编辑 ")])),_:2},1032,["onClick"]),t(r,{size:"small",type:"danger",onClick:W=>F(o.row._id)},{default:n(()=>e[12]||(e[12]=[b(" 删除 ")])),_:2},1032,["onClick"])]),_:1})]),_:1},8,["data"]),t(x,{"current-page":w.value,"onUpdate:currentPage":e[0]||(e[0]=o=>w.value=o),"page-size":V.value,"onUpdate:pageSize":e[1]||(e[1]=o=>V.value=o),"page-sizes":[5,10,15,20],layout:"total, sizes, prev, pager, next, jumper",total:z.value,onSizeChange:R,onCurrentChange:P},null,8,["current-page","page-size","total"]),t(I,{modelValue:_.value,"onUpdate:modelValue":e[9]||(e[9]=o=>_.value=o),title:"添加/编辑用户",width:"500"},{footer:n(()=>[E("div",re,[t(r,{type:"primary",onClick:e[7]||(e[7]=o=>u(a)._id==null?M(h.value):q(h.value))},{default:n(()=>e[13]||(e[13]=[b(" 确定 ")])),_:1}),t(r,{onClick:e[8]||(e[8]=o=>_.value=!1)},{default:n(()=>e[14]||(e[14]=[b("取消")])),_:1})])]),default:n(()=>[t(j,{model:u(a),ref_key:"userFormRef",ref:h,rules:T,"label-width":"100px","label-position":"right",style:{width:"400px"}},{default:n(()=>[t(v,{label:"用户名",prop:"username"},{default:n(()=>[t(f,{modelValue:u(a).username,"onUpdate:modelValue":e[2]||(e[2]=o=>u(a).username=o)},null,8,["modelValue"])]),_:1}),t(v,{label:"密码",prop:"password"},{default:n(()=>[t(f,{modelValue:u(a).password,"onUpdate:modelValue":e[3]||(e[3]=o=>u(a).password=o),type:"password"},null,8,["modelValue"])]),_:1}),t(v,{label:"姓名",prop:"name"},{default:n(()=>[t(f,{modelValue:u(a).name,"onUpdate:modelValue":e[4]||(e[4]=o=>u(a).name=o)},null,8,["modelValue"])]),_:1}),t(v,{label:"所属角色",prop:"role_id"},{default:n(()=>[t(A,{modelValue:u(a).role_id,"onUpdate:modelValue":e[5]||(e[5]=o=>u(a).role_id=o),placeholder:"请选择所属角色"},{default:n(()=>[(y(!0),B(Y,null,O(u(m),o=>(y(),te(N,{label:o.name,value:o._id,key:o._id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),t(v,{label:"电话号码",prop:"phone"},{default:n(()=>[t(f,{modelValue:u(a).phone,"onUpdate:modelValue":e[6]||(e[6]=o=>u(a).phone=o)},null,8,["modelValue"])]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["modelValue"])])}}});export{me as default};
