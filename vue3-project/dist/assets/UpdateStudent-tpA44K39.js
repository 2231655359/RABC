import{D as J,d as de,G as De,r as f,i as se,H as Le,I as Me,J as Pe,K as ae,q as le,u as Be,a as oe,o as b,c as j,b as l,w as i,e as Re,z as xe,f as C,F as A,s as D,k,g as $,L as Ne,M as Ke,y as ze,N as $e,h as Fe,O as Te,v as L,_ as Ge}from"./index-DkugqgKa.js";import{u as He}from"./student-CDUywyxc.js";import{u as Ye}from"./class-CBCYlJYE.js";import{u as Je}from"./role-7JurnY40.js";import{u as Qe}from"./school-DtmllmaV.js";import{u as We}from"./major-DGD-pr_j.js";import"./index-Bug_QlJt.js";var Xe=["onActivate","onAddUndo","onBeforeAddUndo","onBeforeExecCommand","onBeforeGetContent","onBeforeRenderUI","onBeforeSetContent","onBeforePaste","onBlur","onChange","onClearUndos","onClick","onContextMenu","onCommentChange","onCompositionEnd","onCompositionStart","onCompositionUpdate","onCopy","onCut","onDblclick","onDeactivate","onDirty","onDrag","onDragDrop","onDragEnd","onDragGesture","onDragOver","onDrop","onExecCommand","onFocus","onFocusIn","onFocusOut","onGetContent","onHide","onInit","onInput","onKeyDown","onKeyPress","onKeyUp","onLoadContent","onMouseDown","onMouseEnter","onMouseLeave","onMouseMove","onMouseOut","onMouseOver","onMouseUp","onNodeChange","onObjectResizeStart","onObjectResized","onObjectSelected","onPaste","onPostProcess","onPostRender","onPreProcess","onProgressState","onRedo","onRemove","onReset","onSaveContent","onSelectionChange","onSetAttrib","onSetContent","onShow","onSubmit","onUndo","onVisualAid"],Ze=function(t){return Xe.map(function(d){return d.toLowerCase()}).indexOf(t.toLowerCase())!==-1},et=function(t,d,r){Object.keys(d).filter(Ze).forEach(function(v){var m=d[v];typeof m=="function"&&(v==="onInit"?m(t,r):r.on(v.substring(2),function(p){return m(p,r)}))})},tt=function(t,d,r,v){var m=t.modelEvents?t.modelEvents:null,p=Array.isArray(m)?m.join(" "):m;J(v,function(y,h){r&&typeof y=="string"&&y!==h&&y!==r.getContent({format:t.outputFormat})&&r.setContent(y)}),r.on(p||"change input undo redo",function(){d.emit("update:modelValue",r.getContent({format:t.outputFormat}))})},nt=function(t,d,r,v,m,p){v.setContent(p()),r.attrs["onUpdate:modelValue"]&&tt(d,r,v,m),et(t,r.attrs,v)},re=0,me=function(t){var d=Date.now(),r=Math.floor(Math.random()*1e9);return re++,t+"_"+r+re+String(d)},at=function(t){return t!==null&&t.tagName.toLowerCase()==="textarea"},ue=function(t){return typeof t>"u"||t===""?[]:Array.isArray(t)?t:t.split(" ")},lt=function(t,d){return ue(t).concat(ue(d))},ot=function(t){return t==null},ie=function(){return{listeners:[],scriptId:me("tiny-script"),scriptLoaded:!1}},rt=function(){var t=ie(),d=function(m,p,y,h){var c=p.createElement("script");c.referrerPolicy="origin",c.type="application/javascript",c.id=m,c.src=y;var V=function(){c.removeEventListener("load",V),h()};c.addEventListener("load",V),p.head&&p.head.appendChild(c)},r=function(m,p,y){t.scriptLoaded?y():(t.listeners.push(y),m.getElementById(t.scriptId)||d(t.scriptId,m,p,function(){t.listeners.forEach(function(h){return h()}),t.scriptLoaded=!0}))},v=function(){t=ie()};return{load:r,reinitialize:v}},ut=rt(),it=function(){return typeof window<"u"?window:global},M=function(){var t=it();return t&&t.tinymce?t.tinymce:null},dt={apiKey:String,licenseKey:String,cloudChannel:String,id:String,init:Object,initialValue:String,inline:Boolean,modelEvents:[String,Array],plugins:[String,Array],tagName:String,toolbar:[String,Array],modelValue:String,disabled:Boolean,tinymceScriptSrc:String,outputFormat:{type:String,validator:function(t){return t==="html"||t==="text"}}},U=function(){return U=Object.assign||function(t){for(var d,r=1,v=arguments.length;r<v;r++){d=arguments[r];for(var m in d)Object.prototype.hasOwnProperty.call(d,m)&&(t[m]=d[m])}return t},U.apply(this,arguments)},st=function(t,d,r,v){return t(v||"div",{id:d,ref:r})},mt=function(t,d,r){return t("textarea",{id:d,visibility:"hidden",ref:r})},Y={selector:void 0,target:void 0},ct=de({props:dt,setup:function(t,d){var r=t.init?U(U({},t.init),Y):U({},Y),v=De(t),m=v.disabled,p=v.modelValue,y=v.tagName,h=f(null),c=null,V=t.id||me("tiny-vue"),N=t.init&&t.init.inline||t.inline,P=!!d.attrs["onUpdate:modelValue"],I=!0,B=t.initialValue?t.initialValue:"",E="",R=function(g){return P?function(){return p!=null&&p.value?p.value:""}:function(){return g?B:E}},w=function(){var g=R(I),_=U(U({},r),{readonly:t.disabled,target:h.value,plugins:lt(r.plugins,t.plugins),toolbar:t.toolbar||r.toolbar,inline:N,license_key:t.licenseKey,setup:function(O){c=O,O.on("init",function(F){return nt(F,t,d,O,p,g)}),typeof r.setup=="function"&&r.setup(O)}});at(h.value)&&(h.value.style.visibility=""),M().init(_),I=!1};J(m,function(g){var _;c!==null&&(typeof((_=c.mode)===null||_===void 0?void 0:_.set)=="function"?c.mode.set(g?"readonly":"design"):c.setMode(g?"readonly":"design"))}),J(y,function(g){var _;P||(E=c.getContent()),(_=M())===null||_===void 0||_.remove(c),le(function(){return w()})}),se(function(){if(M()!==null)w();else if(h.value&&h.value.ownerDocument){var g=t.cloudChannel?t.cloudChannel:"7",_=t.apiKey?t.apiKey:"no-api-key",O=ot(t.tinymceScriptSrc)?"https://cdn.tiny.cloud/1/".concat(_,"/tinymce/").concat(g,"/tinymce.min.js"):t.tinymceScriptSrc;ut.load(h.value.ownerDocument,O,w)}}),Le(function(){M()!==null&&M().remove(c)}),N||(Me(function(){I||w()}),Pe(function(){var g;P||(E=c.getContent()),(g=M())===null||g===void 0||g.remove(c)}));var x=function(g){var _;E=c.getContent(),(_=M())===null||_===void 0||_.remove(c),r=U(U(U({},r),g),Y),le(function(){return w()})};return d.expose({rerender:x,getEditor:function(){return c}}),function(){return N?st(ae,V,h,t.tagName):mt(ae,V,h)}}});const vt={class:"student-update"},pt=["src"],ft={class:"el-upload-list__item-actions"},gt=["onClick"],_t=["onClick"],ht=["src"],bt=de({__name:"UpdateStudent",setup(t){const d="/pro-api";let r=Re(),v=xe();const m=f(""),p=f(!1),y=f(!1),h=a=>{Te.post("/manage/img/delete",{name:a.name}).then(e=>{e.status==0&&V.value.splice(V.value.indexOf(a),1)})},c=a=>{m.value=a.url,p.value=!0},V=f([]),N=(a,e)=>{if(a.status=="success"){const s=a.response;if(s.status==0){const{name:u,url:S}=s.data;a=e[e.length-1],a.name=u,a.url=S}}V.value=e},P=()=>V.value.map(a=>a.name);let I=He(),B=Ye(),E=Je(),R=Be(),w=Qe(),x=We(),g=f([]),_=f([]),O=f(""),F=f(""),Q=f([]),W=f([]),ce=f([{_id:"0",name:"男"},{_id:"1",name:"女"}]),ve=f([{_id:"1",name:"大一"},{_id:"2",name:"大二"},{_id:"3",name:"大三"},{_id:"4",name:"大四"},{_id:"5",name:"在读研究生"}]),pe=f([{_id:"1",name:"专科"},{_id:"2",name:"本科"},{_id:"3",name:"硕士"},{_id:"4",name:"社会"}]),fe=f([{_id:"1",name:"web前端"},{_id:"2",name:"Java"},{_id:"3",name:"C/C++"},{_id:"4",name:"少儿编程"},{_id:"5",name:"直播电商"}]);const T=f([]),K=f([]),z=f([]),ge=()=>{var a;(a=B.classes)!=null&&a.length?T.value=B.classes:B.getClassAll().then(()=>{T.value=B.classes})},_e=()=>{var a;(a=w.schools)!=null&&a.length?K.value=w.schools:w.getSchoolAll().then(()=>{K.value=w.schools})},he=()=>{var a;(a=x.majors)!=null&&a.length?z.value=x.majors:x.getMajorAll().then(()=>{z.value=x.majors})},be=()=>{var a;(a=E.roles)!=null&&a.length?(_.value=E.roles,X()):E.roleList().then(()=>{_.value=E.roles,X()})},X=()=>{_.value.forEach(a=>{a.name=="教师"?O.value=a._id:a.name=="学管"&&(F.value=a._id)})},ye=()=>{R.users.length?(g.value=R.users,Z()):R.getUserAll().then(()=>{g.value=R.users,Z()})},Z=()=>{g.value.forEach(a=>{a.role_id==O.value?Q.value.push(a):a.role_id==F.value&&W.value.push(a)})},o=f({_id:null,name:"",gender:"",school:"",major:"",grade:"",education:"",direction:"",id_number:"",phone:"",parent:"",parent_phone:"",address:"",qq:"",class:"",admission_date:"",teacher_id:"",manager_id:"",pictures:new Array,note:""}),G=f(),Ve=oe({name:[{required:!0,message:"请输入姓名",trigger:"blur"}],gender:[{required:!0,message:"请选择性别",trigger:"change"}],direction:[{required:!0,message:"请选择学习方向",trigger:"change"}],id_number:[{required:!0,validator:(a,e,s)=>{e=e.trim();const u=/^([1-6][1-9]|50)\d{4}(18|19|20)\d{2}((0[1-9])|10|11|12)(([0-2][1-9])|10|20|30|31)\d{3}[0-9Xx]$/,S=/^([1-6][1-9]|50)\d{4}\d{2}((0[1-9])|10|11|12)(([0-2][1-9])|10|20|30|31)\d{3}$/;u.test(e)||S.test(e)?s():s(new Error("请输入正确的身份证号码"))},trigger:["blur","change"]}],phone:[{required:!0,validator:(a,e,s)=>{e=e.trim();const u=/^(13[0-9]|14[01456879]|15[0-35-9]|16[2567]|17[0-8]|18[0-9]|19[0-35-9])\d{8}$/;e==""?s(new Error("请输入手机号码")):u.test(e)?s():s(new Error("请输入正确的手机号码"))},trigger:["blur","change"]}],class:[{required:!0,message:"请选择班级",trigger:"change"}],admission_date:[{required:!0,message:"请选择入学时间",trigger:"change"}],teacher_id:[{required:!0,message:"请选择授课教师",trigger:"change"}],manager_id:[{required:!0,message:"请选择学管",trigger:"change"}]}),Se=a=>{a&&a.validate(e=>{e?(o.value.pictures=P(),I.addStudent(o.value).then(()=>{r.push("/student")})):console.log("error submit!")})},Ce=a=>{a&&a.validate(e=>{e?(o.value.pictures=P(),I.updateStudent(o.value).then(()=>{r.push("/student")})):console.log("error submit!")})},ke=(a,e)=>{K.value.forEach(u=>u.value=u.schoolname);const s=a?K.value.filter(ee(a)):K.value;e(s)},we=(a,e)=>{z.value.forEach(u=>u.value=u.majorname);const s=a?z.value.filter(ee(a)):z.value;e(s)},ee=a=>e=>e.value.toLowerCase().indexOf(a.toLowerCase())===0,te=oe({apiKey:"w8593t1vo6t8c9rf9zdr5m40p28g9j790kfdk0lema1vq658",init:{toolbar_mode:"sliding",plugins:"anchor autolink charmap codesample emoticons image link lists media searchreplace table visualblocks wordcount checklist mediaembed casechange export formatpainter pageembed linkchecker a11ychecker tinymcespellchecker permanentpen powerpaste advtable advcode editimage advtemplate ai mentions tinycomments tableofcontents footnotes mergetags autocorrect typography inlinecss",toolbar:"undo redo | blocks fontfamily fontsize | bold italic underline strikethrough | link image media table mergetags | addcomment showcomments | spellcheckdialog a11ycheck typography | align lineheight | checklist numlist bullist indent outdent | emoticons charmap | removeformat",tinycomments_mode:"embedded",tinycomments_author:"Author name",mergetags_list:[{value:"First.Name",title:"First Name"},{value:"Email",title:"Email"}],ai_request:(a,e)=>e.string(()=>Promise.reject("See docs to implement AI Assistant"))}}),Ue=()=>{const{_id:a}=v.params;I.getStudentById(a).then(e=>{o.value=e;const{pictures:s}=e;s&&s.length&&(V.value=s.map(u=>({name:u,url:d+"/upload/"+u})))})};return se(()=>{be(),ye(),ge(),_e(),he(),Ue()}),(a,e)=>{const s=C("el-input"),u=C("el-form-item"),S=C("el-option"),q=C("el-select"),ne=C("el-autocomplete"),Ee=C("el-date-picker"),H=C("el-icon"),Oe=C("el-upload"),je=C("el-dialog"),Ie=C("el-button"),qe=C("el-form");return b(),j("div",vt,[l(qe,{ref_key:"studentFormRef",ref:G,model:o.value,"status-icon":"",rules:Ve,"label-width":"100px","label-position":"right",style:{width:"100%",height:"100%"}},{default:i(()=>[l(u,{label:"姓名",prop:"name"},{default:i(()=>[l(s,{modelValue:o.value.name,"onUpdate:modelValue":e[0]||(e[0]=n=>o.value.name=n)},null,8,["modelValue"])]),_:1}),l(u,{label:"性别",prop:"gender"},{default:i(()=>[l(q,{modelValue:o.value.gender,"onUpdate:modelValue":e[1]||(e[1]=n=>o.value.gender=n),placeholder:"请选择性别",clearable:""},{default:i(()=>[(b(!0),j(A,null,D(k(ce),n=>(b(),L(S,{label:n.name,value:n._id,key:n._id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),l(u,{label:"所在学校",prop:"school"},{default:i(()=>[l(ne,{modelValue:o.value.school,"onUpdate:modelValue":e[2]||(e[2]=n=>o.value.school=n),"fetch-suggestions":ke,clearable:"",class:"inline-input w-50",placeholder:"请输入学校"},null,8,["modelValue"])]),_:1}),l(u,{label:"专业",prop:"major"},{default:i(()=>[l(ne,{modelValue:o.value.major,"onUpdate:modelValue":e[3]||(e[3]=n=>o.value.major=n),"fetch-suggestions":we,clearable:"",class:"inline-input w-50",placeholder:"请输入专业"},null,8,["modelValue"])]),_:1}),l(u,{label:"年级",prop:"grade"},{default:i(()=>[l(q,{modelValue:o.value.grade,"onUpdate:modelValue":e[4]||(e[4]=n=>o.value.grade=n),placeholder:"请选择年级",clearable:""},{default:i(()=>[(b(!0),j(A,null,D(k(ve),n=>(b(),L(S,{label:n.name,value:n._id,key:n._id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),l(u,{label:"学历",prop:"education"},{default:i(()=>[l(q,{modelValue:o.value.education,"onUpdate:modelValue":e[5]||(e[5]=n=>o.value.education=n),placeholder:"请选择学历",clearable:""},{default:i(()=>[(b(!0),j(A,null,D(k(pe),n=>(b(),L(S,{label:n.name,value:n._id,key:n._id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),l(u,{label:"学习方向",prop:"direction"},{default:i(()=>[l(q,{modelValue:o.value.direction,"onUpdate:modelValue":e[6]||(e[6]=n=>o.value.direction=n),placeholder:"根据学习方向查询",clearable:""},{default:i(()=>[(b(!0),j(A,null,D(k(fe),n=>(b(),L(S,{label:n.name,value:n._id,key:n._id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),l(u,{label:"身份号码",prop:"id_number"},{default:i(()=>[l(s,{modelValue:o.value.id_number,"onUpdate:modelValue":e[7]||(e[7]=n=>o.value.id_number=n)},null,8,["modelValue"])]),_:1}),l(u,{label:"电话号码",prop:"phone"},{default:i(()=>[l(s,{modelValue:o.value.phone,"onUpdate:modelValue":e[8]||(e[8]=n=>o.value.phone=n)},null,8,["modelValue"])]),_:1}),l(u,{label:"家长姓名",prop:"parent"},{default:i(()=>[l(s,{modelValue:o.value.parent,"onUpdate:modelValue":e[9]||(e[9]=n=>o.value.parent=n)},null,8,["modelValue"])]),_:1}),l(u,{label:"家长联系电话",prop:"parent_phone"},{default:i(()=>[l(s,{modelValue:o.value.parent_phone,"onUpdate:modelValue":e[10]||(e[10]=n=>o.value.parent_phone=n)},null,8,["modelValue"])]),_:1}),l(u,{label:"家庭住址",prop:"address"},{default:i(()=>[l(s,{modelValue:o.value.address,"onUpdate:modelValue":e[11]||(e[11]=n=>o.value.address=n)},null,8,["modelValue"])]),_:1}),l(u,{label:"QQ号码",prop:"qq"},{default:i(()=>[l(s,{modelValue:o.value.qq,"onUpdate:modelValue":e[12]||(e[12]=n=>o.value.qq=n)},null,8,["modelValue"])]),_:1}),l(u,{label:"所在班级",prop:"class"},{default:i(()=>[l(q,{modelValue:o.value.class,"onUpdate:modelValue":e[13]||(e[13]=n=>o.value.class=n),placeholder:"请选择班级",clearable:""},{default:i(()=>[(b(!0),j(A,null,D(T.value,n=>(b(),L(S,{label:n.classname,value:n._id,key:n._id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),l(u,{label:"入学时间",prop:"admission_date"},{default:i(()=>[l(Ee,{modelValue:o.value.admission_date,"onUpdate:modelValue":e[14]||(e[14]=n=>o.value.admission_date=n),type:"date",placeholder:"请选择入学时间","value-format":"YYYY-MM-DD"},null,8,["modelValue"])]),_:1}),l(u,{label:"授课教师",prop:"teacher_id"},{default:i(()=>[l(q,{modelValue:o.value.teacher_id,"onUpdate:modelValue":e[15]||(e[15]=n=>o.value.teacher_id=n),placeholder:"请选择授课教师",clearable:""},{default:i(()=>[(b(!0),j(A,null,D(k(Q),n=>(b(),L(S,{label:n.name,value:n._id,key:n._id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),l(u,{label:"学管",prop:"manager_id"},{default:i(()=>[l(q,{modelValue:o.value.manager_id,"onUpdate:modelValue":e[16]||(e[16]=n=>o.value.manager_id=n),placeholder:"请选择学管",clearable:""},{default:i(()=>[(b(!0),j(A,null,D(k(W),n=>(b(),L(S,{label:n.name,value:n._id,key:n._id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),l(u,{label:"照片",prop:"pictures"},{default:i(()=>[l(Oe,{action:k(d)+"/manage/img/upload","list-type":"picture-card",name:"image",accept:"iamge/*","file-list":V.value,"on-change":N,"auto-upload":!0},{file:i(({file:n})=>[$("div",null,[$("img",{class:"el-upload-list__item-thumbnail",src:n.url,alt:""},null,8,pt),$("span",ft,[$("span",{class:"el-upload-list__item-preview",onClick:Ae=>c(n)},[l(H,null,{default:i(()=>[l(k(Ne))]),_:1})],8,gt),y.value?ze("",!0):(b(),j("span",{key:0,class:"el-upload-list__item-delete",onClick:Ae=>h(n)},[l(H,null,{default:i(()=>[l(k(Ke))]),_:1})],8,_t))])])]),default:i(()=>[l(H,null,{default:i(()=>[l(k($e))]),_:1})]),_:1},8,["action","file-list"]),l(je,{modelValue:p.value,"onUpdate:modelValue":e[17]||(e[17]=n=>p.value=n)},{default:i(()=>[$("img",{"w-full":"",src:m.value,alt:"Preview Image"},null,8,ht)]),_:1},8,["modelValue"])]),_:1}),l(u,{label:"备注信息",prop:"note",style:{width:"100%"}},{default:i(()=>[l(k(ct),{modelValue:o.value.note,"onUpdate:modelValue":e[18]||(e[18]=n=>o.value.note=n),"api-key":te.apiKey,init:te.init},null,8,["modelValue","api-key","init"])]),_:1}),l(u,null,{default:i(()=>[l(Ie,{type:"primary",onClick:e[19]||(e[19]=n=>o.value._id==null?Se(G.value):Ce(G.value))},{default:i(()=>e[20]||(e[20]=[Fe(" 确定 ")])),_:1})]),_:1})]),_:1},8,["model","rules"])])}}}),jt=Ge(bt,[["__scopeId","data-v-9072b579"]]);export{jt as default};
