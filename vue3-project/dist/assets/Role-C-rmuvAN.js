import{u as O}from"./role-7JurnY40.js";import{a as E}from"./dateUtils-CvItVsSG.js";import{m as K}from"./menuConfig-BcKxkvSg.js";import{d as $,r as s,a as k,i as B,f as u,o as L,c as D,b as l,w as n,k as b,u as j,g as A,q as z,h as x,C as G,v as H,y as I}from"./index-DkugqgKa.js";const J=$({__name:"Auth",props:["role"],setup(N,{expose:V}){const _=N,c=s(),d=k({name:[{required:!0,message:"请输入角色名称",trigger:"blur"}]});let m=k({name:""});const g=s([]);let a=k([]);const h=o=>o.map(t=>t.children?{index:t.index,label:t.title,children:h(t.children)}:{index:t.index,label:t.title}),y=(o,t,p)=>{t?o.index!="/students"&&a.indexOf(o.index)==-1&&a.push(o.index):a.indexOf(o.index)!=-1&&a.splice(a.indexOf(o.index),1)};return V({getMenus:()=>(m.menus=a,m)}),B(()=>{g.value=h(K),m=k({..._.role}),a=[..._.role.menus]}),(o,t)=>{const p=u("el-input"),w=u("el-form-item"),F=u("el-form"),C=u("el-tree");return L(),D("div",null,[l(F,{ref_key:"roleFormRef",ref:c,style:{"max-width":"400px"},model:b(m),rules:d,"label-width":"100px"},{default:n(()=>[l(w,{label:"角色名称",prop:"name"},{default:n(()=>[l(p,{modelValue:b(m).name,"onUpdate:modelValue":t[0]||(t[0]=U=>b(m).name=U),placeholder:"请输入角色名称"},null,8,["modelValue"])]),_:1})]),_:1},8,["model","rules"]),l(C,{data:g.value,"show-checkbox":"","node-key":"index","default-expand-all":!0,"default-checked-keys":b(a),onCheckChange:y},null,8,["data","default-checked-keys"])])}}}),P={style:{margin:"20px 0"}},Q={class:"dialog-footer"},W={class:"dialog-footer"},le=$({__name:"Role",setup(N){let V=j();const _=s();let c=O();const d=s(),m=s();let g=s([]);const a=r=>{d.value=r},h=()=>{o.value=!0,z(()=>{var r;(r=_.value)==null||r.resetFields()})},y=()=>{c.roleList().then(()=>{g.value=c.roles})},R=(r,e,f,v)=>E(f),o=s(!1),t=s(!1),p=s({name:""}),w=k({name:[{required:!0,message:"请输入角色名称",trigger:"blur"}]}),F=r=>{r&&r.validate(e=>{e?c.useAddRole(p.value).then(()=>{o.value=!1,y()}):console.log("error submit!")})},C=s(),U=()=>{var e;const r=C.value.getMenus();d.value.menus=r.menus,d.value.name=r.name,d.value.auth_name=(e=V.user)==null?void 0:e.username,c.useUpdateRole(d.value).then(()=>{t.value=!1,y()})};return B(()=>{y()}),(r,e)=>{const f=u("el-button"),v=u("el-table-column"),M=u("el-input"),S=u("el-form-item"),q=u("el-form"),T=u("el-dialog");return L(),D("div",null,[A("div",P,[l(f,{type:"primary",onClick:h},{default:n(()=>e[7]||(e[7]=[x("添加角色")])),_:1}),l(f,{type:"primary",disabled:d.value==null,onClick:e[0]||(e[0]=i=>t.value=!0)},{default:n(()=>e[8]||(e[8]=[x("设置角色权限")])),_:1},8,["disabled"])]),l(b(G),{ref_key:"singleTableRef",ref:m,height:"380",border:"",data:b(g),"highlight-current-row":"",style:{width:"100%"},onCurrentChange:a},{default:n(()=>[l(v,{type:"index",width:"80",label:"序号"}),l(v,{property:"name",label:"角色名称"}),l(v,{property:"create_time",label:"创建时间",formatter:R}),l(v,{property:"auth_time",label:"授权时间",formatter:R}),l(v,{property:"auth_name",label:"授权人"})]),_:1},8,["data"]),l(T,{modelValue:o.value,"onUpdate:modelValue":e[4]||(e[4]=i=>o.value=i),title:"添加角色",width:"500"},{footer:n(()=>[A("div",Q,[l(f,{type:"primary",onClick:e[2]||(e[2]=i=>F(_.value))},{default:n(()=>e[9]||(e[9]=[x(" 确定 ")])),_:1}),l(f,{onClick:e[3]||(e[3]=i=>o.value=!1)},{default:n(()=>e[10]||(e[10]=[x("取消")])),_:1})])]),default:n(()=>[l(q,{model:p.value,ref_key:"roleFormRef",ref:_,"label-width":"100px",style:{width:"400px"},rules:w},{default:n(()=>[l(S,{label:"角色名称",prop:"name"},{default:n(()=>[l(M,{modelValue:p.value.name,"onUpdate:modelValue":e[1]||(e[1]=i=>p.value.name=i),placeholder:"请输入角色名称"},null,8,["modelValue"])]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["modelValue"]),l(T,{modelValue:t.value,"onUpdate:modelValue":e[6]||(e[6]=i=>t.value=i),title:"设置角色权限",width:"500"},{footer:n(()=>[A("div",W,[t.value?(L(),H(J,{key:0,role:d.value,ref_key:"authRef",ref:C},null,8,["role"])):I("",!0),l(f,{type:"primary",onClick:U},{default:n(()=>e[11]||(e[11]=[x(" 确定 ")])),_:1}),l(f,{onClick:e[5]||(e[5]=i=>t.value=!1)},{default:n(()=>e[12]||(e[12]=[x("取消")])),_:1})])]),_:1},8,["modelValue"])])}}});export{le as default};
